/**
 * animated-marker-clusters - A library for animated marker clusters on Google, Mapbox or Bing maps
 * @version v0.0.1
 * @link https://github.com/WearyMonkey/animated-marker-clusters
 * @license MIT
 */
!function e(t,n,o){function i(r,_){if(!n[r]){if(!t[r]){var a="function"==typeof require&&require;if(!_&&a)return a(r,!0);if(s)return s(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[r]={exports:{}};t[r][0].call(u.exports,function(e){var n=t[r][1][e];return i(n?n:e)},u,u.exports,e,t,n,o)}return n[r].exports}for(var s="function"==typeof require&&require,r=0;r<o.length;r++)i(o[r]);return i}({1:[function(e){window.wm={Markers:e("./../markers.js"),Point:e("./../point.js"),Line:e("./../line.js"),mapConnectors:{google:e("./../map-connectors/google.js")},defaultMapConnector:"google"}},{"./../line.js":4,"./../map-connectors/google.js":5,"./../markers.js":6,"./../point.js":7}],2:[function(e,t){function n(e){var t,o,i,s,r=Number.MAX_VALUE;if(!e._bestPoint)if(o=e._parent&&n(e._parent),o&&null!=e._points[o._id])e._bestPoint=o;else for(t in e._points)e._points.hasOwnProperty(t)&&(s=e._points[t],i=u(e,s,e._center),r>i&&(e._bestPoint=s,r=i));return e._bestPoint}function o(e,t){var n,o,s,r,_={},a=e._zoom+e._zoomRange;if(!(a>e._geo.maxZoom)){for(n=0;n<t.length;++n)s=t[n],o=i(e,s._latLng,e._children),_[o._id]=_[o._id]||[],_[o._id].push(s);for(n=0;n<e._children;++n)o=e._children[n],r=_[o._id],r&&o.addPoints(r)}}function i(e,t,n){return _(e,t,n,!0)}function s(e,t,n){var o,a,u,c,h=[];if(!e._children.length){for(o in e._points)e._points.hasOwnProperty(o)&&(u=new d(e,e._geo.maxZoom,1,e._geo,e._settings),u.addPoints([e._points[o]]),e._children.push(u));if(0==--n)return!0}for(e._children.length<3?c=e._children:(c=[_(e,e._center,e._children)],c.push(_(e,c[0]._center,e._children))),o=0;o<c.length;++o)u=new d(e,t,n,e._geo,e._settings),h.push(u),u._center=e._geo.getBoundsCenter(c[o]._bounds);for(o=0;o<e._children.length;++o){var p=e._children[o];u=i(e,e._geo.getBoundsCenter(p._bounds),h),u._children.push(p)}for(e._children=h,e._pointToChild={},o=0;o<h.length;++o){for(u=h[o],a=0;a<u._children.length;++a)r(e,u,u._children[a]);u._center=e._geo.getBoundsCenter(u._bounds),u._zoomRange=l(u),u._zoomRange<n&&s(u,u._zoom+u._zoomRange,n-u._zoomRange)}return!0}function r(e,t,n){t._bounds=e._geo.extendBounds(t._bounds,[n._bounds]),n._parent=t;for(var o in n._points)if(n._points.hasOwnProperty(o)){var i=n._points[o];t._points[i._id]=i,t._pointToChild[i._id]=n,e._pointToChild[i._id]=t}}function _(e,t,n,o){for(var i,s=o?Number.MAX_VALUE:0,r=0;r<n.length;++r){var _=n[r],a=u(e,t,_._center);(o&&s>a||!o&&a>s)&&(s=a,i=_)}return i}function a(e){if(!e._parent)return!1;var t,n=e._parent._children,o=e._zoom;for(t=0;t<n.length;++t)n[t]==e&&n.splice(t,1);for(t=0;t<e._children.length;++t){var i=e._children[t];i._zoomRange+=i._zoom-o,i._zoom=o,i._parent=e._parent,n.push(i)}return!0}function l(e){var t,n=e._geo.getBoundsSpan(e._bounds),o=e._zoom,i=e._zoom+e._zoomRange-1;for(t=n._lat>n._lng?n._lat:n._lng;i>o&&e._settings.zoomBoxes[i].max<t;)i--;return i-o+1}function u(e,t,n){var o=null!=t._lat?t:e._geo.getLatLng(t._latLng||t),i=null!=n._lat?n:e._geo.getLatLng(n._latLng||n);return c(o._lat,o._lng,i._lat,i._lng)}function c(e,t,n,o){var i=e-n,s=t-o;return i*i+s*s}var h=e("./utils.js"),p=1,d=function(e,t,n,o,i){this._parent=e,this._settings=i,this._geo=o,this._id=p++,this._zoom=t,this._zoomRange=n,this._children=[],this._points={},this._pointToChild={},this._connections=[],this._bounds=o.createBounds(),this._center=o.createLatLng(0,0),this._expandDepth=0};h.extend(d.prototype,{getBounds:function(){return this._bounds},getCenter:function(){return this._center},getDisplayCenter:function(){return n(this)._latLng},getPoints:function(){var e=[];for(var t in this._points)this._points.hasOwnProperty(t)&&e.push(this._points[t]);return e},getMarker:function(){return this._marker},getParent:function(){return this._parent},getExpandDepth:function(){return this._expandDepth},getZoomRange:function(){return{from:this._zoom,to:this._zoom+this._zoomRange-1}},removePoints:function(e){var t,n=!1;for(t=0;t<e.length;++t){var o=e[t];this._points[o._id]&&(delete this._points[o._id],n=!0,this._parent&&delete this._parent._pointToChild[o._id])}if(n){for(t=0;t<this._children.length;++t){var i=this._children[t];i.removePoints(e)||(this._children.splice(t,1),--t)}this._bestPoint=null,this._bounds=this._geo.createBounds();var s=[];for(var r in this._points)this._points.hasOwnProperty(r)&&s.push(this._points[r]._latLng);return this._bounds=this._geo.extendBounds(this._bounds,s),!!s.length}return!0},addPoints:function(e){var t,n=!1,i=[];for(t=0;t<e.length;++t){var r=e[t];this._points[r._id]||(this._points[r._id]=r,i.push(r._latLng),this._parent&&(this._parent._pointToChild[r._id]=this),n=!0)}if(this._bounds=this._geo.extendBounds(this._bounds,i),n){this._bestPoint=null,this._center=this._geo.getBoundsCenter(this._bounds),o(this,e);var _=this._zoomRange;this._zoomRange=l(this),this._zoomRange<_&&s(this,this._zoom+this._zoomRange,_-this._zoomRange),0==this._zoomRange&&a(this)}},addLine:function(e){for(var t=this._pointToChild,n={},o=1;o<e._points.length;++o){var i=e._points[o]._id,s=e._points[o-1]._id,r=t[i],_=t[s];r&&_&&r!=_&&this._connections.push({_id:p++,_pointId1:i,_pointId2:s,_cluster1:t[i],_cluster2:t[s],_line:e}),r&&(n[r._id]||(n[r._id]=!0,r.addLine(e)))}},removeLine:function(e){for(var t={},n=this._connections,o=0;o<n.length;++o){var i=n[o];if(i._line==e){n.splice(o--,1);var s=this._pointToChild[i._pointId1],r=this._pointToChild[i._pointId2];t[s._id]||s.removeLine(e),t[r._id]||r.removeLine(e),t[s._id]=!0,t[r._id]=!0}}}}),t.exports=d},{"./utils.js":8}],3:[function(e){function t(e,o,i,s,r,_,a,l,u,c,h,p){s=Math.max(null!=e[u]?e[u]:e[c],s-1,0),i=Math.max(null!=e[c]?e[c]:e[u],i-1,0);var d=e._zoom+e._zoomRange-1>=l&&0==s,g=!e._children.length||-1==e._expandDepth;if(g||d)h.push({cluster:e,parent:o});else{e._zoom+e._zoomRange-1>=a&&0==i&&(o=e),p&&n(e,o,i,s,a,l,u,c,p);for(var f=0;f<e._children.length;++f){var m=e._children[f];(_&&m._points[r]||!_&&e._geo.boundsIntersects(m._bounds,r))&&t(m,o,i,s,r,_,a,l,u,c,h,p)}}return h}function n(e,n,o,i,s,r,_,a,l){for(var u=0;u<e._connections.length;u++){var c=e._connections[u];c._displayCluster1=t(c._cluster1,n,o,i,c._pointId1,!0,s,r,_,a,[])[0],c._displayCluster2=t(c._cluster2,n,o,i,c._pointId2,!0,s,r,_,a,[])[0],l.push(c)}}var o=e("./utils.js"),i=e("./cluster.js");o.extend(i.prototype,{getContainedClustersAndConnections:function(e,n,o,i,s){var r=[],_=[];return this._geo.boundsIntersects(this._bounds,e)&&t(this,null,0,0,e,!1,o,n,i,s,r,_),{clusters:r,connections:_}}})},{"./cluster.js":2,"./utils.js":8}],4:[function(e,t){function n(e){for(var t=[],n=0;n<e.length;++n)t.push(o(e[n]));return t}var o=e("./point"),i=e("./utils.js"),s=1,r=function(e,t){return e instanceof r?e:this instanceof r?(this._id=s++,this._points=n(e),this._data=t,void 0):new r(e,t)};i.extend(r.prototype,{getPoints:function(){return this._points},getData:function(){return this._data}}),t.exports=r},{"./point":7,"./utils.js":8}],5:[function(e,t){t.exports={maxZoom:20,createMarker:function(){return new google.maps.Marker},createPolyline:function(){return new google.maps.Polyline},createLatLng:function(e,t){return new google.maps.LatLng(e,t)},getLatLng:function(e){return{_lat:e.lat(),_lng:e.lng()}},getMarkerPosition:function(e){return e.getPosition()},setMarkerPosition:function(e,t){e.setPosition(t)},getPolylinePath:function(e){return e.getPath().getArray().slice()},setPolylinePath:function(e,t){e.setPath(new google.maps.MVCArray(t))},showMarker:function(e,t){t.setMap(e)},showPolyline:function(e,t){t.setMap(e)},hideMarker:function(e,t){t.setMap(null)},hidePolyline:function(e,t){t.setMap(null)},createBounds:function(){return new google.maps.LatLngBounds},extendBounds:function(e,t){for(var n=0;n<t.length;++n){var o=t[n];o instanceof google.maps.LatLng?e.extend(o):o instanceof google.maps.LatLngBounds&&e.union(o)}return e},getBoundsCenter:function(e){return e.getCenter()},boundsIntersects:function(e,t){return e.intersects(t)},getBoundsSpan:function(e){var t=e.toSpan();return{_lat:t.lat(),_lng:t.lng()}},onMapBoundsChange:function(e,t){return google.maps.event.addListener(e,"bounds_changed",t)},off:function(e){google.maps.event.removeListener(e)},getMapZoom:function(e){return e.getZoom()},getMapBounds:function(e){return e.getBounds()},onMarkerClicked:function(e,t){return google.maps.event.addListener(e,"click",t)}}},{}],6:[function(e,t){function n(e,t,n){for(var o=new RegExp("^"+t+"(\\..*)?$"),i=0;i<e._listeners.length;++i){var s=e._listeners[i];s.event.match(o)&&s.callback(v.extend({markers:e},n))}}function o(e,t,o){return t._keepKey=e._keepKey,e._visibleClusters.push(t),t._marker||(t._marker=e._options.createMarker(t),t._clickListener=e._geo.onMarkerClicked(t._marker,function(){n(e,"clusterClicked",{cluster:t})})),t._dLat=t._dLng=null,e._geo.setMarkerPosition(t._marker,o||t.getDisplayCenter()),t._visible||(e._geo.showMarker(e._map,t._marker),t._visible=!0,n(e,"clusterShown",{cluster:t})),t._marker}function i(e,t){return t._keepKey=e._keepKey,e._visibleConnections.push(t),t._polyline=t._polyline||e._options.createPolyline(t._line),e._geo.setPolylinePath(t._polyline,[t._displayCluster1.cluster._marker?e._geo.getMarkerPosition(t._displayCluster1.cluster._marker):t._displayCluster1.cluster.getDisplayCenter(),t._displayCluster2.cluster._marker?e._geo.getMarkerPosition(t._displayCluster2.cluster._marker):t._displayCluster2.cluster.getDisplayCenter()]),t._visible||(e._geo.showPolyline(e._map,t._polyline),t._visible=!0,n(e,"lineShown",{line:t._line})),t._polyline}function s(e,t,o){t._marker&&(e._geo.hideMarker(e._map,t._marker),t._visible=!1,n(e,"clusterHidden",{cluster:t}),o&&(e._geo.off(t._clickListener),delete t._marker))}function r(e,t,o){t._polyline&&(e._geo.hidePolyline(e._map,t._polyline),t._visible=!1,n(e,"lineHidden",{line:t._line}),o&&delete t._polyline)}function _(e){var t,n=e._clusterRoot.getContainedClustersAndConnections(g(e),e._zoom,e._prevZoom,"_expandDepth","_oldExpandDepth");for(t=0;t<n.clusters.length;++t)o(e,n.clusters[t].cluster);for(t=0;t<n.connections.length;++t)i(e,n.connections[t])}function a(e){var t=e._clusterRoot.getContainedClustersAndConnections(g(e),e._zoom,e._prevZoom,"_expandDepth","_oldExpandDepth");u(e,t,!1)}function l(e){var t=e._clusterRoot.getContainedClustersAndConnections(g(e),e._prevZoom,e._zoom,"_oldExpandDepth","_expandDepth");u(e,t,!0)}function u(e,t,n){var o;for(o=0;o<t.clusters.length;++o)c(e,t.clusters[o],n);for(o=0;o<t.connections.length;o++){var s=t.connections[o];c(e,s._displayCluster1,n),c(e,s._displayCluster2,n),i(e,s)}h(e)}function c(e,t,n){var i=t.parent,s=t.cluster;if(s._keepKey!=e._keepKey)if(i){var r=n?i:s,_=n?s:i,a=e._geo.getLatLng(r.getDisplayCenter()),l=e._geo.getLatLng(_.getDisplayCenter());o(e,s,_.getDisplayCenter()),s._dLat=(a._lat-l._lat)/e._options.animationSteps,s._dLng=(a._lng-l._lng)/e._options.animationSteps}else o(e,s)}function h(e){function t(){if(o++<e._options.animationSteps){for(n=0;n<e._visibleClusters.length;++n){var s=e._visibleClusters[n],r=e._visibleClusters[n]._marker;if(s._dLat||s._dLng){var _=p(e,e._geo.getMarkerPosition(r),s);e._geo.setMarkerPosition(r,_)}}for(n=0;n<e._visibleConnections.length;++n){var a=e._visibleConnections[n],l=a._displayCluster1.cluster,u=a._displayCluster2.cluster;if(l._dLat||u._dLat||l._dLng||u._dLng){var c=a._polyline,h=e._geo.getPolylinePath(c);h[0]=p(e,h[0],l),h[1]=p(e,h[1],u),e._geo.setPolylinePath(c,h)}}e._timeout=setTimeout(t,i)}else d(e)}var n,o=0,i=e._options.animationInterval;t()}function p(e,t,n){if(!n||!n._dLat&&!n._dLng)return t;var o=e._geo.getLatLng(t);return e._geo.createLatLng(o._lat+n._dLat,o._lng+n._dLng)}function d(e,t){var n=e._visibleClusters,o=e._visibleConnections;e._keepKey=(e._keepKey+1)%3735928559,e._visibleClusters=[],e._visibleConnections=[],clearTimeout(e._timeout),t===!1||e._prevZoom<e._zoom?a(e):t===!0||e._prevZoom>e._zoom?l(e):_(e),setTimeout(function(){var t;for(t=0;t<n.length;++t){var i=n[t];i._keepKey!=e._keepKey&&s(e,i)}for(t=0;t<o.length;++t){var _=o[t];_._keepKey!=e._keepKey&&r(e,_)}},0)}function g(e){return e._geo.getMapBounds(e._map)}function f(e){for(var t=[],n=84.375,o=112.6,i=1,s=0;s<=e.maxZoom;s++)t[s]={min:n/i,max:o/i},i<<=1;return t}var m=e("./cluster.js");e("./cluster_search.js");var v=e("./utils.js"),C=e("./point.js"),y=e("./line.js"),L=function(e,t){var n=this;this._visibleClusters=[],this._visibleConnections=[],this._keepKey=0,this._map=e,this._zoom=this._prevZoom=this._map.getZoom(),this._geo=t.mapConnector||wm.defaultMapConnector&&wm.mapConnectors&&wm.mapConnectors[wm.defaultMapConnector],this._options=v.extend({animationSteps:30,animationInterval:16,createMarker:this._geo.createMarker,createPolyline:this._geo.createPolyline},t),this._clusterRoot=new m(null,0,this._geo.maxZoom+1,this._geo,{zoomBoxes:f(this._geo)}),this._listeners=[],d(this),this._boundsListener=n._geo.onMapBoundsChange(e,function(){var t=n._geo.getMapZoom(e);0>t||t>n._geo.maxZoom||(n._prevZoom=n._zoom,n._zoom=t,d(n),n._prevZoom=t,n._prevBounds=n._geo.getMapBounds(e))})};v.extend(L.prototype,{on:function(e,t){return this._listeners.push({event:e,callback:t}),this},off:function(e,t){for(var n=0;n<this._listeners.length;++n){var o=this._listeners[n];o.event!=e||t&&t!=o.callback||this._listeners.splice(n--,1)}return this},addLine:function(e,t){return e=y(e),t&&t.addPoints===!0&&this._clusterRoot.addPoints(e._points),this._clusterRoot.addLine(e),d(this),e},removeLine:function(e,t){this._clusterRoot.removeLine(e),t&&t.removePoints===!0&&this._clusterRoot.removePoints(e._points),d(this)},addPoint:function(e){return e=C(e),this._clusterRoot.addPoints([e]),d(this),e},removePoint:function(e){this._clusterRoot.removePoints([e]),d(this)},addPoints:function(e){for(var t=[],n=0;n<e.length;++n)t.push(C(e[n]));return this._clusterRoot.addPoint(t),d(this),t},removePoints:function(e){this._clusterRoot.removePoints(e),d(this)},destroy:function(){for(var e=0;e<this._visibleClusters.length;++e)s(this,this._visibleClusters[e],!0);for(e=0;e<this._visibleConnections.length;++e)r(this,this._visibleConnections[e],!0);this._boundsListener&&this._geo.offMapsBoundChange(this._boundsListener)},setClusterState:function(e,t){if("normal"==t)for(;e&&0==e._expandDepth;)e=e._parent;if(e){var n,o=e._expandDepth;e._oldExpandDepth=o,"normal"==t?(e._expandDepth=0,o>0?n=!0:0>o&&(n=!1)):"collapsed"==t?(e._expandDepth=-1,n=!0):"expanded"==t&&(e._expandDepth=1,n=!1),d(this,n),delete e._oldExpandDepth}}}),t.exports=L},{"./cluster.js":2,"./cluster_search.js":3,"./line.js":4,"./point.js":7,"./utils.js":8}],7:[function(e,t){var n=e("./utils.js"),o=1,i=function(e,t){return e instanceof i?e:this instanceof i?(this._id=o++,this._latLng=e,this._data=t,void 0):new i(e,t)};n.extend(i.prototype,{getLatLng:function(){return this._latLng},getData:function(){return this._data}}),t.exports=i},{"./utils.js":8}],8:[function(e,t){t.exports={extend:function(e){for(var t=1;t<arguments.length;++t){var n=arguments[t];for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])}return e}}},{}]},{},[1]);